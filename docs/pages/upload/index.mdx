import MultiUpload from "../../components/upload/MultiUpload";
import PictureUpload from "../../components/upload/PictureUpload";

# Upload

Upload file or image.

- Preprocessing allow before upload
- Support AJAX upload via `XMLHttpRequest`.

## Examples

### List upload

<MultiUpload />

```jsx
import { Upload } from "@w-design/upload";

const MultiUpload = () => {
  return (
    <Upload
      multiple
      requestUpload={{
        endpoint: "https://www.mocky.io/v2/5cc8019d300000980a055e76",
        method: "POST",
        headers: {
          authorization: "authorization-text"
        }
      }}
    />
  );
};
```

### Picture upload

<PictureUpload />

### API

| Props           | type    | default | description |
| --------------- | ------- | ------- | ----------- |
| accept          | string  |         |             |
| multiple        | boolean |         |             |
| label           |         |         |             |
| defaultFileList |         |         |             |
| beforeUpload    |         |         |             |
| requestUpload   |         |         |             |
| onChange        |         |         |             |
| disabled        |         |         |             |
| onRemove        |         |         |             |

### Custom upload control

You can use the `xhrRequest` API to custom your upload by using `useEffect` hooks.
Here is the snippets example from the `Upload` component

```jsx
...

const [xhr, setXhr] = useState < any > undefined;

useEffect(() => {
  if (!xhr) {
    setXhr(xhrRequest());
  }
}, [xhr, xhrRequest]);

const post = async (file: UploadFileType): Promise<void> => {
  if (xhr) {
    try {
      const result = await xhr.upload({
        ...requestUpload,
        file,
        onLoadStart: () => {
          const newFileList = updateFileState(file, fileList, {
            status: "progress"
          });
          setFileList(newFileList);
        },
        onProgress: (e: ProgressEvent<EventTarget>) => {
          let percentLoaded = 0;

          if (e.lengthComputable) {
            percentLoaded = Math.round((e.loaded / e.total) * 100);
          }

          const newFileList = updateFileState(file, fileList, {
            percent: percentLoaded
          });
          setFileList(newFileList);
        }
      });

      const newFileList = updateFileState(file, fileList, {
        status: "success",
        response: result
      });

      return setFileList(newFileList);
    } catch (err) {
      const newFileList = updateFileState(file, fileList, {
        status: "error",
        response: err
      });
      return setFileList(newFileList);
    }
  }
};

const handleUploadCancel = (file: UploadFileType) => {
  if (!xhr) return;
  // if upload is in progress: handle abort event
  if (file.status === "progress") {
    const newFileList = updateFileState(file, fileList, {
      status: "error"
    });
    setFileList(newFileList);
    return xhr && xhr.abort();
  }

  const fileInFileList = getFileItem(file, fileList);
  return setFileList(fileList.filter(item => fileInFileList != item));
};
```
